' @startuml "Каталог товаров ТРУ"
' actor  Участник_торгов as Foo0
' participant Карточка_товара as Foo1
' participant Краткое_название as Foo2
' collections Перечень_берживых_товаров as Foo3
' participant Сохранить as Foo4
' Foo0 -> Foo1: Заполнение поля
' Foo0 -> Foo2: Заполнение поля
' Foo0 -> Foo3: Заполнение табличной части
' Foo0 -> Foo4: Нажать Сохранить (Создать)
' Foo4 -> Foo5: Сохранения в БД

' @enduml


@startuml "Каталог товаров ТРУ"
actor  Участник_торгов as Foo0
participant Карточка_товара as Foo1
participant Краткое_название_товара as Foo2
participant Отделение_товара as Foo3
participant Категория_товара as Foo4
participant Вид_товара as Foo6
participant Лот as Foo7
participant Размер_лота as Foo8
participant Регион as Foo13
participant Базис_поставки as Foo9
participant Завод_производитель as Foo10
participant Упаковка as Foo11
participant Описание_товара as Foo12
participant Продавец as Foo13
participant Спецификация as Foo14
collections Документы as Foo15
participant Дата_создания as Foo16
participant Дата_изменения as Foo17
participant Автор as Foo18

database БД as Foo5

Foo0 -> Foo1: Выбрать наименование товара из справочника
Foo0 -> Foo0: Товара нет в каталоге наименований товаров(Запрос на добавление нового наименования)
Foo2 --> Foo0: Заполнены поля "Наименование товара" и "Краткое название"
Foo0 -> Foo3: Выбрать отделение из справочника
Foo3 --> Foo4: Отображение в поле "Категория товара" значений из выбранного "Отделения товара"
Foo3 --> Foo0: Заполнено поле "Отделение товара"
Foo0 -> Foo4: Выбрать "Категорию товара"
Foo4 --> Foo6: Отображение в поле "Вид_товара" значений из выбранной "Категории"
Foo4 --> Foo0: Заполнено поле "Категория_товара"
Foo0 -> Foo6: Выбрать "Вид_товара"
Foo6 --> Foo0: Заполнено поле "Вид_товара"
Foo0 -> Foo7: Заполнить поле "Лот"
Foo7 --> Foo0: Заполнено поле "Лот"
Foo0 -> Foo8: Заполнить поле "Размер_лота"
Foo8 --> Foo0: Заполнено поле "Размер_лота"
Foo0 -> Foo9: Заполнить поле "Регион"
Foo9 --> Foo0: Заполнено поле "Регион"
Foo0 -> Foo10: Заполнить поле "Завод_производитель"
Foo10 --> Foo0: Заполнено поле "Завод_производитель"
Foo0 -> Foo11: Заполнить поле "Упаковка"
Foo11 --> Foo0: Заполнено поле "Упаковка"
Foo0 --> Foo12: Заполнить поле "Описание_товара"


group Дополнительная инфомрация
    Foo0 --> Foo14 : Спецификация
    Foo0 --> Foo13 : Продавец
    Foo0 --> Foo15 : Документы
    Foo0 --> Foo16 : Дата создания
    Foo0 --> Foo17 : Дата изменения
    Foo0 --> Foo18 : Автор
end

Foo0 <-- Foo3: Карточка_товара
Foo0 -> Foo4: Нажать Сохранить (Создать)
Foo4 -> Foo5: Сохранения в БД
@enduml



/'v2 Схема'/
@startuml "ЦТС.А3.2 Добавление товара в Каталог"
/'Название файла будет: ЦТС.<Номер схемы БП>.<Номер этапа>.<Название этапа в схеме БП>'/
title "ЦТС.А3.2. Добавление товара в Каталог"
actor "Участник Торгов" as User
boundary "Карточка товара" as Commodities
database "База данных" as Database
participant "Менеджер торгов" as User_CTS
collections "Каталог Наименований товаров" as CommoditiesNames

autonumber
activate User
User -> Commodities: Ввести данные Наименование товара
note right
    manual:  Классификатор товара, Вид товара, Лот, Размер лота, Регион поставки, Базис поставки, Завод-производитель, Упаковка, Описание товара
    Перечень берживых товаров (табличная часть);
    auto: Проверка введённого наименования на наличие в Каталоге, Мнемоника, Краткое наименование товара, Статус, Дата создания, Автор.
end note
deactivate User

Commodities --> Database: Запрос в БД 
    activate Database
    /'Проверка корректно заполненных данных Каталог наименования товара->Участник Торгов'/
    Database -> Commodities: Проверка корректно заполненных данных
    deactivate Database
    Commodities --> User: Ошибка! Неправильные введены данные! Не заполнены обязательные поля
    activate User
    /'Ошибка и т.д. в Каталог наименования товара->Участник Торгов'/
    User-->Commodities: Корректировка ранее введенных данных
    deactivate User
    User->User_CTS: Запросы на добавления товара в Каталог наименования товара 
        /'Администратор Торгов'/
        activate User_CTS
        User_CTS->User_CTS: Проверка корректно заполненных данных
        User_CTS->User: Отказ
    note right
         manual: Причина отказа
    end note

    User_CTS-->Database: Утверждение
        deactivate User_CTS
    note right
         auto: Запись наименования в Каталог наименований
    end note
        CommoditiesNames-->Database: Запись нового наименования в БД
        CommoditiesNames-->User: Наименование доступно для выбора в Карточке товара
    activate User
    User-->Commodities: Корректировка ранее введенных данных
    deactivate User    
    deactivate User 
    Commodities->Database: Сохранение данных в базе данных
    activate Database
        Database->User_CTS: Запрос на добавление наименования в Каталог наименования товара 
        /'Администратор Торгов'/
        activate User_CTS
        User_CTS->User_CTS: Проверка корректно заполненных данных, Утверждение 
        User_CTS->CommoditiesNames: Утверждение, Отказ
        CommoditiesNames-->User: Причина отказа
        User_CTS->Database: Сохранение данных в базе данных
        deactivate User_CTS
        deactivate Database
        CommoditiesNames->CommoditiesNames: Cоздание записи в Каталоге наименования товара
        activate CommoditiesNames
        deactivate CommoditiesNames      
    deactivate CommoditiesNames
@enduml